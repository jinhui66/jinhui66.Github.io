
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>第四章 分组 &#8212; python-lib</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'python-lib/pandas/notebook/04 分组';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="第五章 变形" href="05%20%E5%8F%98%E5%BD%A2.html" />
    <link rel="prev" title="第三章 索引" href="03%20%E7%B4%A2%E5%BC%95.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="python-lib - Home"/>
    <img src="../../../_static/logo.png" class="logo__image only-dark pst-js-only" alt="python-lib - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Pandas</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01%20%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86.html">第一章 预备知识</a></li>
<li class="toctree-l1"><a class="reference internal" href="02%20pandas%E5%9F%BA%E7%A1%80.html">第二章 pandas基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="03%20%E7%B4%A2%E5%BC%95.html">第三章 索引</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">第四章 分组</a></li>
<li class="toctree-l1"><a class="reference internal" href="05%20%E5%8F%98%E5%BD%A2.html">第五章 变形</a></li>
<li class="toctree-l1"><a class="reference internal" href="06%20%E8%BF%9E%E6%8E%A5.html">第六章 连接</a></li>
<li class="toctree-l1"><a class="reference internal" href="07%20%E7%BC%BA%E5%A4%B1%E6%95%B0%E6%8D%AE.html">第七章 缺失数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="08%20%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE.html">第八章 文本数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="09%20%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE.html">第九章 分类数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="10%20%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE.html">第十章 时序数据</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%8F%82%E8%80%83%E7%AD%94%E6%A1%88.html">参考答案</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fpython-lib/pandas/notebook/04 分组.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button"
   title="Open an issue"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/python-lib/pandas/notebook/04 分组.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>第四章 分组</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">一、分组模式及其对象</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1. 分组的一般模式</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2. 分组依据的本质</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#end">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#groupby">3. Groupby对象</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">4. 分组的三大操作</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">二、聚合函数</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">1. 内置聚合函数</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#agg">2. agg方法</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">【END】</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">三、变换和过滤</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform">1. 变换函数与transform方法</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">2. 组索引与过滤</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">【END】</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">四、跨列分组</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apply">1. apply的引入</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">2. apply的使用</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">【END】</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">五、练习</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ex1">Ex1：汽车数据集</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ex2-transform">Ex2：实现transform函数</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>第四章 分组<a class="headerlink" href="#id1" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h2>一、分组模式及其对象<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<section id="id3">
<h3>1. 分组的一般模式<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>分组操作在日常生活中使用极其广泛，例如：</p>
<ul class="simple">
<li><p>依据<span class="math notranslate nohighlight">\(\color{#FF0000}{性别}\)</span>分组，统计全国人口<span class="math notranslate nohighlight">\(\color{#00FF00}{寿命}\)</span>的<span class="math notranslate nohighlight">\(\color{#0000FF}{平均值}\)</span></p></li>
<li><p>依据<span class="math notranslate nohighlight">\(\color{#FF0000}{季节}\)</span>分组，对每一个季节的<span class="math notranslate nohighlight">\(\color{#00FF00}{温度}\)</span>进行<span class="math notranslate nohighlight">\(\color{#0000FF}{组内标准化}\)</span></p></li>
<li><p>依据<span class="math notranslate nohighlight">\(\color{#FF0000}{班级}\)</span>筛选出组内<span class="math notranslate nohighlight">\(\color{#00FF00}{数学分数}\)</span>的<span class="math notranslate nohighlight">\(\color{#0000FF}{平均值超过80分的班级}\)</span></p></li>
</ul>
<p>从上述的几个例子中不难看出，想要实现分组操作，必须明确三个要素：<span class="math notranslate nohighlight">\(\color{#FF0000}{分组依据}\)</span>、<span class="math notranslate nohighlight">\(\color{#00FF00}{数据来源}\)</span>、<span class="math notranslate nohighlight">\(\color{#0000FF}{操作及其返回结果}\)</span>。同时从充分性的角度来说，如果明确了这三方面，就能确定一个分组操作，从而分组代码的一般模式即：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">分组依据</span><span class="p">)[</span><span class="n">数据来源</span><span class="p">]</span><span class="o">.</span><span class="n">使用操作</span>
</pre></div>
</div>
<p>例如第一个例子中的代码就应该如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">)[</span><span class="s1">&#39;Longevity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
<p>现在返回到学生体测的数据集上，如果想要按照性别统计身高中位数，就可以如下写出：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/learn_pandas.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">)[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gender
Female    159.6
Male      173.4
Name: Height, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h3>2. 分组依据的本质<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>前面提到的若干例子都是以单一维度进行分组的，比如根据性别，如果现在需要根据多个维度进行分组，该如何做？事实上，只需在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>中传入相应列名构成的列表即可。例如，现希望根据学校和性别进行分组，统计身高的均值就可以如下写出：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;School&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">])[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>School                         Gender
Fudan University               Female    158.776923
                               Male      174.212500
Peking University              Female    158.666667
                               Male      172.030000
Shanghai Jiao Tong University  Female    159.122500
                               Male      176.760000
Tsinghua University            Female    159.753333
                               Male      171.638889
Name: Height, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>目前为止，<code class="docutils literal notranslate"><span class="pre">groupby</span></code>的分组依据都是直接可以从列中按照名字获取的，那如果希望通过一定的复杂逻辑来分组，例如根据学生体重是否超过总体均值来分组，同样还是计算身高的均值。</p>
<p>首先应该先写出分组条件：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Weight</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>然后将其传入<code class="docutils literal notranslate"><span class="pre">groupby</span></code>中：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">condition</span><span class="p">)[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Weight
False    159.034646
True     172.705357
Name: Height, dtype: float64
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h4>【练一练】<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<p>请根据上下四分位数分割，将体重分为high、normal、low三组，统计身高的均值。</p>
</section>
<section id="end">
<h4>【END】<a class="headerlink" href="#end" title="Link to this heading">#</a></h4>
<p>从索引可以看出，其实最后产生的结果就是按照条件列表中元素的值（此处是<code class="docutils literal notranslate"><span class="pre">True</span></code>和<code class="docutils literal notranslate"><span class="pre">False</span></code>）来分组，下面用随机传入字母序列来验证这一想法：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">),</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">item</span><span class="p">)[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a    162.805797
b    164.347917
c    162.827273
Name: Height, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>此处的索引就是原先item中的元素，如果传入多个序列进入<code class="docutils literal notranslate"><span class="pre">groupby</span></code>，那么最后分组的依据就是这两个序列对应行的唯一组合：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">condition</span><span class="p">,</span> <span class="n">item</span><span class="p">])[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Weight   
False   a    159.361224
        b    158.616129
        c    158.970213
True    a    171.245000
        b    174.800000
        c    172.368421
Name: Height, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>由此可以看出，之前传入列名只是一种简便的记号，事实上等价于传入的是一个或多个列，最后分组的依据来自于数据来源组合的unique值，通过<code class="docutils literal notranslate"><span class="pre">drop_duplicates</span></code>就能知道具体的组类别：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;School&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>School</th>
      <th>Gender</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Shanghai Jiao Tong University</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Peking University</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shanghai Jiao Tong University</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fudan University</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Fudan University</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Tsinghua University</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Peking University</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Tsinghua University</td>
      <td>Male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;School&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]])[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>School                         Gender
Fudan University               Female    158.776923
                               Male      174.212500
Peking University              Female    158.666667
                               Male      172.030000
Shanghai Jiao Tong University  Female    159.122500
                               Male      176.760000
Tsinghua University            Female    159.753333
                               Male      171.638889
Name: Height, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="groupby">
<h3>3. Groupby对象<a class="headerlink" href="#groupby" title="Link to this heading">#</a></h3>
<p>能够注意到，最终具体做分组操作时，所调用的方法都来自于<code class="docutils literal notranslate"><span class="pre">pandas</span></code>中的<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象，这个对象上定义了许多方法，也具有一些方便的属性。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;School&#39;</span><span class="p">,</span> <span class="s1">&#39;Grade&#39;</span><span class="p">])</span>
<span class="n">gb</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x000001532F024DC0&gt;
</pre></div>
</div>
</div>
</div>
<p>通过<code class="docutils literal notranslate"><span class="pre">ngroups</span></code>属性，可以得到分组个数：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">ngroups</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16
</pre></div>
</div>
</div>
</div>
<p>通过<code class="docutils literal notranslate"><span class="pre">groups</span></code>属性，可以返回从<span class="math notranslate nohighlight">\(\color{#FF0000}{组名}\)</span>映射到<span class="math notranslate nohighlight">\(\color{#FF0000}{组索引列表}\)</span>的字典：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">groups</span>
<span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="c1"># 字典的值由于是索引，元素个数过多，此处只展示字典的键</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([(&#39;Fudan University&#39;, &#39;Freshman&#39;), (&#39;Fudan University&#39;, &#39;Junior&#39;), (&#39;Fudan University&#39;, &#39;Senior&#39;), (&#39;Fudan University&#39;, &#39;Sophomore&#39;), (&#39;Peking University&#39;, &#39;Freshman&#39;), (&#39;Peking University&#39;, &#39;Junior&#39;), (&#39;Peking University&#39;, &#39;Senior&#39;), (&#39;Peking University&#39;, &#39;Sophomore&#39;), (&#39;Shanghai Jiao Tong University&#39;, &#39;Freshman&#39;), (&#39;Shanghai Jiao Tong University&#39;, &#39;Junior&#39;), (&#39;Shanghai Jiao Tong University&#39;, &#39;Senior&#39;), (&#39;Shanghai Jiao Tong University&#39;, &#39;Sophomore&#39;), (&#39;Tsinghua University&#39;, &#39;Freshman&#39;), (&#39;Tsinghua University&#39;, &#39;Junior&#39;), (&#39;Tsinghua University&#39;, &#39;Senior&#39;), (&#39;Tsinghua University&#39;, &#39;Sophomore&#39;)])
</pre></div>
</div>
</div>
</div>
<section id="id6">
<h4>【练一练】<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<p>上一小节介绍了可以通过<code class="docutils literal notranslate"><span class="pre">drop_duplicates</span></code>得到具体的组类别，现请用<code class="docutils literal notranslate"><span class="pre">groups</span></code>属性完成类似的功能。</p>
</section>
<section id="id7">
<h4>【END】<a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<p>当<code class="docutils literal notranslate"><span class="pre">size</span></code>作为<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>的属性时，返回的是表长乘以表宽的大小，但在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象上表示统计每个组的元素个数：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>School                         Grade    
Fudan University               Freshman      9
                               Junior       12
                               Senior       11
                               Sophomore     8
Peking University              Freshman     13
                               Junior        8
                               Senior        8
                               Sophomore     5
Shanghai Jiao Tong University  Freshman     13
                               Junior       17
                               Senior       22
                               Sophomore     5
Tsinghua University            Freshman     17
                               Junior       22
                               Senior       14
                               Sophomore    16
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>通过<code class="docutils literal notranslate"><span class="pre">get_group</span></code>方法可以直接获取所在组对应的行，此时必须知道组的具体名字：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">get_group</span><span class="p">((</span><span class="s1">&#39;Fudan University&#39;</span><span class="p">,</span> <span class="s1">&#39;Freshman&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>School</th>
      <th>Grade</th>
      <th>Name</th>
      <th>Gender</th>
      <th>Height</th>
      <th>Weight</th>
      <th>Transfer</th>
      <th>Test_Number</th>
      <th>Test_Date</th>
      <th>Time_Record</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Changqiang Yang</td>
      <td>Female</td>
      <td>156.0</td>
      <td>49.0</td>
      <td>N</td>
      <td>3</td>
      <td>2020/1/1</td>
      <td>0:05:25</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Gaoqiang Qin</td>
      <td>Female</td>
      <td>170.2</td>
      <td>63.0</td>
      <td>N</td>
      <td>2</td>
      <td>2020/1/7</td>
      <td>0:05:24</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Gaofeng Zhao</td>
      <td>Female</td>
      <td>152.2</td>
      <td>43.0</td>
      <td>N</td>
      <td>2</td>
      <td>2019/10/31</td>
      <td>0:04:00</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Yanquan Wang</td>
      <td>Female</td>
      <td>163.5</td>
      <td>55.0</td>
      <td>N</td>
      <td>1</td>
      <td>2019/11/19</td>
      <td>0:04:07</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Feng Wang</td>
      <td>Male</td>
      <td>176.3</td>
      <td>74.0</td>
      <td>N</td>
      <td>1</td>
      <td>2019/9/26</td>
      <td>0:03:31</td>
    </tr>
    <tr>
      <th>105</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Qiang Shi</td>
      <td>Female</td>
      <td>164.5</td>
      <td>52.0</td>
      <td>N</td>
      <td>1</td>
      <td>2019/12/11</td>
      <td>0:04:23</td>
    </tr>
    <tr>
      <th>108</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Yanqiang Xu</td>
      <td>Female</td>
      <td>152.4</td>
      <td>38.0</td>
      <td>N</td>
      <td>1</td>
      <td>2019/12/8</td>
      <td>0:05:03</td>
    </tr>
    <tr>
      <th>157</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Xiaoli Lv</td>
      <td>Female</td>
      <td>152.5</td>
      <td>45.0</td>
      <td>N</td>
      <td>2</td>
      <td>2019/9/11</td>
      <td>0:04:17</td>
    </tr>
    <tr>
      <th>186</th>
      <td>Fudan University</td>
      <td>Freshman</td>
      <td>Yanjuan Zhao</td>
      <td>Female</td>
      <td>NaN</td>
      <td>53.0</td>
      <td>N</td>
      <td>2</td>
      <td>2019/10/9</td>
      <td>0:04:21</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>这里列出了2个属性和2个方法，而先前的<code class="docutils literal notranslate"><span class="pre">mean</span></code>、<code class="docutils literal notranslate"><span class="pre">median</span></code>都是<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象上的方法，这些函数和许多其他函数的操作具有高度相似性，将在之后的小节进行专门介绍。</p>
</section>
</section>
<section id="id8">
<h3>4. 分组的三大操作<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<p>熟悉了一些分组的基本知识后，重新回到开头举的三个例子，可能会发现一些端倪，即这三种类型分组返回的数据型态并不一样：</p>
<ul class="simple">
<li><p>第一个例子中，每一个组返回一个标量值，可以是平均值、中位数、组容量<code class="docutils literal notranslate"><span class="pre">size</span></code>等</p></li>
<li><p>第二个例子中，做了原序列的标准化处理，也就是说每组返回的是一个<code class="docutils literal notranslate"><span class="pre">Series</span></code>类型</p></li>
<li><p>第三个例子中，既不是标量也不是序列，返回的整个组所在行的本身，即返回了<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>类型</p></li>
</ul>
<p>由此，引申出分组的三大操作：聚合、变换和过滤，分别对应了三个例子的操作，下面就要分别介绍相应的<code class="docutils literal notranslate"><span class="pre">agg</span></code>、<code class="docutils literal notranslate"><span class="pre">transform</span></code>和<code class="docutils literal notranslate"><span class="pre">filter</span></code>函数及其操作。</p>
</section>
</section>
<section id="id9">
<h2>二、聚合函数<a class="headerlink" href="#id9" title="Link to this heading">#</a></h2>
<section id="id10">
<h3>1. 内置聚合函数<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>在介绍agg之前，首先要了解一些直接定义在groupby对象的聚合函数，因为它的速度基本都会经过内部的优化，使用功能时应当优先考虑。根据返回标量值的原则，包括如下函数：<code class="docutils literal notranslate"><span class="pre">max/min/mean/median/count/all/any/idxmax/idxmin/mad/nunique/skew/quantile/sum/std/var/sem/size/prod</span></code>。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">)[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span>
<span class="n">gb</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gender
Female    143
Male      199
Name: Height, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.95</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gender
Female    166.8
Male      185.9
Name: Height, dtype: float64
</pre></div>
</div>
</div>
</div>
<section id="id11">
<h4>【练一练】<a class="headerlink" href="#id11" title="Link to this heading">#</a></h4>
<p>请查阅文档，明确<code class="docutils literal notranslate"><span class="pre">all/any/mad/skew/sem/prod</span></code>函数的含义。</p>
</section>
<section id="id12">
<h4>【END】<a class="headerlink" href="#id12" title="Link to this heading">#</a></h4>
<p>这些聚合函数当传入的数据来源包含多个列时，将按照列进行迭代计算：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Gender&#39;</span><span class="p">)[[</span><span class="s1">&#39;Height&#39;</span><span class="p">,</span> <span class="s1">&#39;Weight&#39;</span><span class="p">]]</span>
<span class="n">gb</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>170.2</td>
      <td>63.0</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>193.9</td>
      <td>89.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="agg">
<h3>2. agg方法<a class="headerlink" href="#agg" title="Link to this heading">#</a></h3>
<p>虽然在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象上定义了许多方便的函数，但仍然有以下不便之处：</p>
<ul class="simple">
<li><p>无法同时使用多个函数</p></li>
<li><p>无法对特定的列使用特定的聚合函数</p></li>
<li><p>无法使用自定义的聚合函数</p></li>
<li><p>无法直接对结果的列名在聚合前进行自定义命名</p></li>
</ul>
<p>下面说明如何通过<code class="docutils literal notranslate"><span class="pre">agg</span></code>函数解决这四类问题：</p>
<p>【a】使用多个函数</p>
<p>当使用多个聚合函数时，需要用列表的形式把内置聚合函数对应的字符串传入，先前提到的所有字符串都是合法的。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="s1">&#39;idxmax&#39;</span><span class="p">,</span> <span class="s1">&#39;skew&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">Height</th>
      <th colspan="3" halign="left">Weight</th>
    </tr>
    <tr>
      <th></th>
      <th>sum</th>
      <th>idxmax</th>
      <th>skew</th>
      <th>sum</th>
      <th>idxmax</th>
      <th>skew</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>21014.0</td>
      <td>28</td>
      <td>-0.219253</td>
      <td>6469.0</td>
      <td>28</td>
      <td>-0.268482</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>8854.9</td>
      <td>193</td>
      <td>0.437535</td>
      <td>3929.0</td>
      <td>2</td>
      <td>-0.332393</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>从结果看，此时的列索引为多级索引，第一层为数据源，第二层为使用的聚合方法，分别逐一对列使用聚合，因此结果为6列。</p>
<p>【b】对特定的列使用特定的聚合函数</p>
<p>对于方法和列的特殊对应，可以通过构造字典传入<code class="docutils literal notranslate"><span class="pre">agg</span></code>中实现，其中字典以列名为键，以聚合字符串或字符串列表为值。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Height&#39;</span><span class="p">:[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">],</span> <span class="s1">&#39;Weight&#39;</span><span class="p">:</span><span class="s1">&#39;count&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Height</th>
      <th>Weight</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>max</th>
      <th>count</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>159.19697</td>
      <td>170.2</td>
      <td>135</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>173.62549</td>
      <td>193.9</td>
      <td>54</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="id13">
<h4>【练一练】<a class="headerlink" href="#id13" title="Link to this heading">#</a></h4>
<p>请使用【b】中的传入字典的方法完成【a】中等价的聚合任务。</p>
</section>
<section id="id14">
<h4>【END】<a class="headerlink" href="#id14" title="Link to this heading">#</a></h4>
<p>【c】使用自定义函数</p>
<p>在<code class="docutils literal notranslate"><span class="pre">agg</span></code>中可以使用具体的自定义函数，<span class="math notranslate nohighlight">\(\color{#FF0000}{需要注意传入函数的参数是之前数据源中的列，逐列进行计算}\)</span>。下面分组计算身高和体重的极差：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>13.79697</td>
      <td>13.918519</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>17.92549</td>
      <td>21.759259</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id15">
<h4>【练一练】<a class="headerlink" href="#id15" title="Link to this heading">#</a></h4>
<p>在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象中可以使用<code class="docutils literal notranslate"><span class="pre">describe</span></code>方法进行统计信息汇总，请同时使用多个聚合函数，完成与该方法相同的功能。</p>
</section>
<section id="id16">
<h4>【END】<a class="headerlink" href="#id16" title="Link to this heading">#</a></h4>
<p>由于传入的是序列，因此序列上的方法和属性都是可以在函数中使用的，只需保证返回值是标量即可。下面的例子是指，如果组的指标均值，超过该指标的总体均值，返回High，否则返回Low。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;High&#39;</span>
    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">df</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
        <span class="n">res</span> <span class="o">=</span> <span class="s1">&#39;Low&#39;</span>
    <span class="k">return</span> <span class="n">res</span>
<span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">my_func</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>Low</td>
      <td>Low</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>High</td>
      <td>High</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>【d】聚合结果重命名</p>
<p>如果想要对聚合结果的列名进行重命名，只需要将上述函数的位置改写成元组，元组的第一个元素为新的名字，第二个位置为原来的函数，包括聚合字符串和自定义函数，现举若干例子说明：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">([(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;my_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Height</th>
      <th colspan="2" halign="left">Weight</th>
    </tr>
    <tr>
      <th></th>
      <th>range</th>
      <th>my_sum</th>
      <th>range</th>
      <th>my_sum</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>24.8</td>
      <td>21014.0</td>
      <td>29.0</td>
      <td>6469.0</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>38.2</td>
      <td>8854.9</td>
      <td>38.0</td>
      <td>3929.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;my_func&#39;</span><span class="p">,</span> <span class="n">my_func</span><span class="p">),</span> <span class="s1">&#39;sum&#39;</span><span class="p">],</span> <span class="s1">&#39;Weight&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Height</th>
      <th>Weight</th>
    </tr>
    <tr>
      <th></th>
      <th>my_func</th>
      <th>sum</th>
      <th>&lt;lambda&gt;</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>Low</td>
      <td>21014.0</td>
      <td>63.0</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>High</td>
      <td>8854.9</td>
      <td>89.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>另外需要注意，使用对一个或者多个列使用单个聚合的时候，重命名需要加方括号，否则就不知道是新的名字还是手误输错的内置函数字符串：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">([(</span><span class="s1">&#39;my_sum&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
    <tr>
      <th></th>
      <th>my_sum</th>
      <th>my_sum</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>21014.0</td>
      <td>6469.0</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>8854.9</td>
      <td>3929.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;Height&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;my_func&#39;</span><span class="p">,</span> <span class="n">my_func</span><span class="p">),</span> <span class="s1">&#39;sum&#39;</span><span class="p">],</span> <span class="s1">&#39;Weight&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())]})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Height</th>
      <th>Weight</th>
    </tr>
    <tr>
      <th></th>
      <th>my_func</th>
      <th>sum</th>
      <th>range</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>Low</td>
      <td>21014.0</td>
      <td>63.0</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>High</td>
      <td>8854.9</td>
      <td>89.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
</section>
<section id="id17">
<h2>三、变换和过滤<a class="headerlink" href="#id17" title="Link to this heading">#</a></h2>
<section id="transform">
<h3>1. 变换函数与transform方法<a class="headerlink" href="#transform" title="Link to this heading">#</a></h3>
<p>变换函数的返回值为同长度的序列，最常用的内置变换函数是累计函数：<code class="docutils literal notranslate"><span class="pre">cumcount/cumsum/cumprod/cummax/cummin</span></code>，它们的使用方式和聚合函数类似，只不过完成的是组内累计操作。此外在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象上还定义了填充类和滑窗类的变换函数，这些函数的一般形式将会分别在第七章和第十章中讨论，此处略过。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">cummax</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>158.9</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>166.5</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>188.9</td>
      <td>89.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>188.9</td>
      <td>89.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="id18">
<h4>【练一练】<a class="headerlink" href="#id18" title="Link to this heading">#</a></h4>
<p>在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象中，<code class="docutils literal notranslate"><span class="pre">rank</span></code>方法也是一个实用的变换函数，请查阅它的功能并给出一个使用的例子。</p>
</section>
<section id="id19">
<h4>【END】<a class="headerlink" href="#id19" title="Link to this heading">#</a></h4>
<p>当用自定义变换时需要使用<code class="docutils literal notranslate"><span class="pre">transform</span></code>方法，被调用的自定义函数，<span class="math notranslate nohighlight">\(\color{#FF0000}{其传入值为数据源的序列}\)</span>，与<code class="docutils literal notranslate"><span class="pre">agg</span></code>的传入类型是一致的，其最后的返回结果是行列索引与数据源一致的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>。</p>
<p>现对身高和体重进行分组标准化，即减去组均值后除以组的标准差：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.058760</td>
      <td>-0.354888</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.010925</td>
      <td>-0.355000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.167063</td>
      <td>2.089498</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>-1.279789</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.053133</td>
      <td>0.159631</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id20">
<h4>【练一练】<a class="headerlink" href="#id20" title="Link to this heading">#</a></h4>
<p>对于<code class="docutils literal notranslate"><span class="pre">transform</span></code>方法无法像<code class="docutils literal notranslate"><span class="pre">agg</span></code>一样，通过传入字典来对指定列使用特定的变换，如果需要在一次<code class="docutils literal notranslate"><span class="pre">transform</span></code>的调用中实现这种功能，请给出解决方案。</p>
</section>
<section id="id21">
<h4>【END】<a class="headerlink" href="#id21" title="Link to this heading">#</a></h4>
<p>前面提到了<code class="docutils literal notranslate"><span class="pre">transform</span></code>只能返回同长度的序列，但事实上还可以返回一个标量，这会使得结果被广播到其所在的整个组，这种<span class="math notranslate nohighlight">\(\color{#FF0000}{标量广播}\)</span>的技巧在特征工程中是非常常见的。例如，构造两列新特征来分别表示样本所在性别组的身高均值和体重均值：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> <span class="c1"># 传入返回标量的函数也是可以的</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>159.19697</td>
      <td>47.918519</td>
    </tr>
    <tr>
      <th>1</th>
      <td>173.62549</td>
      <td>72.759259</td>
    </tr>
    <tr>
      <th>2</th>
      <td>173.62549</td>
      <td>72.759259</td>
    </tr>
    <tr>
      <th>3</th>
      <td>159.19697</td>
      <td>47.918519</td>
    </tr>
    <tr>
      <th>4</th>
      <td>173.62549</td>
      <td>72.759259</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="id22">
<h3>2. 组索引与过滤<a class="headerlink" href="#id22" title="Link to this heading">#</a></h3>
<p>在上一章中介绍了索引的用法，那么索引和过滤有什么区别呢？</p>
<p>过滤在分组中是对于组的过滤，而索引是对于行的过滤，在第二章中的返回值，无论是布尔列表还是元素列表或者位置列表，本质上都是对于行的筛选，即如果符合筛选条件的则选入结果表，否则不选入。</p>
<p>组过滤作为行过滤的推广，指的是如果对一个组的全体所在行进行统计的结果返回<code class="docutils literal notranslate"><span class="pre">True</span></code>则会被保留，<code class="docutils literal notranslate"><span class="pre">False</span></code>则该组会被过滤，最后把所有未被过滤的组其对应的所在行拼接起来作为<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>返回。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象中，定义了<code class="docutils literal notranslate"><span class="pre">filter</span></code>方法进行组的筛选，其中自定义函数的输入参数为数据源构成的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>本身，在之前例子中定义的<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象中，传入的就是<code class="docutils literal notranslate"><span class="pre">df[['Height',</span> <span class="pre">'Weight']]</span></code>，因此所有表方法和属性都可以在自定义函数中相应地使用，同时只需保证自定义函数的返回为布尔值即可。</p>
<p>例如，在原表中通过过滤得到所有容量大于100的组：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Height</th>
      <th>Weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>158.9</td>
      <td>46.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>41.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>158.0</td>
      <td>51.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>162.5</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>161.9</td>
      <td>50.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="id23">
<h4>【练一练】<a class="headerlink" href="#id23" title="Link to this heading">#</a></h4>
<p>从概念上说，索引功能是组过滤功能的子集，请使用<code class="docutils literal notranslate"><span class="pre">filter</span></code>函数完成<code class="docutils literal notranslate"><span class="pre">loc[...]</span></code>的功能，这里假设”<code class="docutils literal notranslate"><span class="pre">...</span></code>”是元素列表。</p>
</section>
<section id="id24">
<h4>【END】<a class="headerlink" href="#id24" title="Link to this heading">#</a></h4>
</section>
</section>
</section>
<section id="id25">
<h2>四、跨列分组<a class="headerlink" href="#id25" title="Link to this heading">#</a></h2>
<section id="apply">
<h3>1. apply的引入<a class="headerlink" href="#apply" title="Link to this heading">#</a></h3>
<p>之前几节介绍了三大分组操作，但事实上还有一种常见的分组场景，无法用前面介绍的任何一种方法处理，例如现在如下定义身体质量指数BMI：
$<span class="math notranslate nohighlight">\({\rm BMI} = {\rm\frac{Weight}{Height^2}}\)</span>$
其中体重和身高的单位分别为千克和米，需要分组计算组BMI的均值。</p>
<p>首先，这显然不是过滤操作，因此<code class="docutils literal notranslate"><span class="pre">filter</span></code>不符合要求；其次，返回的均值是标量而不是序列，因此<code class="docutils literal notranslate"><span class="pre">transform</span></code>不符合要求；最后，似乎使用<code class="docutils literal notranslate"><span class="pre">agg</span></code>函数能够处理，但是之前强调过聚合函数是逐列处理的，而不能够<span class="math notranslate nohighlight">\(\color{#FF0000}{多列数据同时处理}\)</span>。由此，引出了<code class="docutils literal notranslate"><span class="pre">apply</span></code>函数来解决这一问题。</p>
</section>
<section id="id26">
<h3>2. apply的使用<a class="headerlink" href="#id26" title="Link to this heading">#</a></h3>
<p>在设计上，<code class="docutils literal notranslate"><span class="pre">apply</span></code>的自定义函数传入参数与<code class="docutils literal notranslate"><span class="pre">filter</span></code>完全一致，只不过后者只允许返回布尔值。现如下解决上述计算问题：</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BMI</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">Height</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Height&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">Weight</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span>
    <span class="n">BMI_value</span> <span class="o">=</span> <span class="n">Weight</span><span class="o">/</span><span class="n">Height</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">BMI_value</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">gb</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">BMI</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gender
Female    18.860930
Male      24.318654
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>除了返回标量之外，<code class="docutils literal notranslate"><span class="pre">apply</span></code>方法还可以返回一维<code class="docutils literal notranslate"><span class="pre">Series</span></code>和二维<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，但它们产生的数据框维数和多级索引的层数应当如何变化？下面举三组例子就非常容易明白结果是如何生成的：</p>
<p>【a】标量情况：结果得到的是 <code class="docutils literal notranslate"><span class="pre">Series</span></code> ，索引与 <code class="docutils literal notranslate"><span class="pre">agg</span></code> 的结果一致</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Gender&#39;</span><span class="p">,</span><span class="s1">&#39;Test_Number&#39;</span><span class="p">])[[</span><span class="s1">&#39;Height&#39;</span><span class="p">,</span><span class="s1">&#39;Weight&#39;</span><span class="p">]]</span>
<span class="n">gb</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gender  Test_Number
Female  1              0
        2              0
        3              0
Male    1              0
        2              0
        3              0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="c1"># 虽然是列表，但是作为返回值仍然看作标量</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gender  Test_Number
Female  1              [0, 0]
        2              [0, 0]
        3              [0, 0]
Male    1              [0, 0]
        2              [0, 0]
        3              [0, 0]
dtype: object
</pre></div>
</div>
</div>
</div>
<p>【b】<code class="docutils literal notranslate"><span class="pre">Series</span></code>情况：得到的是<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，行索引与标量情况一致，列索引为<code class="docutils literal notranslate"><span class="pre">Series</span></code>的索引</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>a</th>
      <th>b</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th>Test_Number</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">Female</th>
      <th>1</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Male</th>
      <th>1</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="id27">
<h4>【练一练】<a class="headerlink" href="#id27" title="Link to this heading">#</a></h4>
<p>请尝试在<code class="docutils literal notranslate"><span class="pre">apply</span></code>传入的自定义函数中，根据组的某些特征返回相同长度但索引不同的<code class="docutils literal notranslate"><span class="pre">Series</span></code>，会报错吗？</p>
</section>
<section id="id28">
<h4>【END】<a class="headerlink" href="#id28" title="Link to this heading">#</a></h4>
<p>【c】<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>情况：得到的是<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，行索引最内层在每个组原先<code class="docutils literal notranslate"><span class="pre">agg</span></code>的结果索引上，再加一层返回的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>行索引，同时分组结果<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>的列索引和返回的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>列索引一致。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gb</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">([(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">),(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">)])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>w</th>
      <th>y</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th>x</th>
      <th>z</th>
    </tr>
    <tr>
      <th>Gender</th>
      <th>Test_Number</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="6" valign="top">Female</th>
      <th rowspan="2" valign="top">1</th>
      <th>a</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>a</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>a</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th rowspan="6" valign="top">Male</th>
      <th rowspan="2" valign="top">1</th>
      <th>a</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>a</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">3</th>
      <th>a</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="id29">
<h4>【练一练】<a class="headerlink" href="#id29" title="Link to this heading">#</a></h4>
<p>请尝试在<code class="docutils literal notranslate"><span class="pre">apply</span></code>传入的自定义函数中，根据组的某些特征返回相同大小但列索引不同的<code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>，会报错吗？如果只是行索引不同，会报错吗？</p>
</section>
<section id="id30">
<h4>【END】<a class="headerlink" href="#id30" title="Link to this heading">#</a></h4>
<p>最后需要强调的是，<code class="docutils literal notranslate"><span class="pre">apply</span></code>函数的灵活性是以牺牲一定性能为代价换得的，除非需要使用跨列处理的分组处理，否则应当使用其他专门设计的<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象方法，否则在性能上会存在较大的差距。同时，在使用聚合函数和变换函数时，也应当优先使用内置函数，它们经过了高度的性能优化，一般而言在速度上都会快于用自定义函数来实现。</p>
</section>
<section id="id31">
<h4>【练一练】<a class="headerlink" href="#id31" title="Link to this heading">#</a></h4>
<p>在<code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象中还定义了<code class="docutils literal notranslate"><span class="pre">cov</span></code>和<code class="docutils literal notranslate"><span class="pre">corr</span></code>函数，从概念上说也属于跨列的分组处理。请利用之前定义的<code class="docutils literal notranslate"><span class="pre">gb</span></code>对象，使用apply函数实现与<code class="docutils literal notranslate"><span class="pre">gb.cov()</span></code>同样的功能并比较它们的性能。</p>
</section>
<section id="id32">
<h4>【END】<a class="headerlink" href="#id32" title="Link to this heading">#</a></h4>
</section>
</section>
</section>
<section id="id33">
<h2>五、练习<a class="headerlink" href="#id33" title="Link to this heading">#</a></h2>
<section id="ex1">
<h3>Ex1：汽车数据集<a class="headerlink" href="#ex1" title="Link to this heading">#</a></h3>
<p>现有一份汽车数据集，其中<code class="docutils literal notranslate"><span class="pre">Brand,</span> <span class="pre">Disp.,</span> <span class="pre">HP</span></code>分别代表汽车品牌、发动机蓄量、发动机输出。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/car.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Brand</th>
      <th>Price</th>
      <th>Country</th>
      <th>Reliability</th>
      <th>Mileage</th>
      <th>Type</th>
      <th>Weight</th>
      <th>Disp.</th>
      <th>HP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Eagle Summit 4</td>
      <td>8895</td>
      <td>USA</td>
      <td>4.0</td>
      <td>33</td>
      <td>Small</td>
      <td>2560</td>
      <td>97</td>
      <td>113</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ford Escort   4</td>
      <td>7402</td>
      <td>USA</td>
      <td>2.0</td>
      <td>33</td>
      <td>Small</td>
      <td>2345</td>
      <td>114</td>
      <td>90</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Ford Festiva 4</td>
      <td>6319</td>
      <td>Korea</td>
      <td>4.0</td>
      <td>37</td>
      <td>Small</td>
      <td>1845</td>
      <td>81</td>
      <td>63</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ol class="arabic simple">
<li><p>先过滤出所属<code class="docutils literal notranslate"><span class="pre">Country</span></code>数超过2个的汽车，即若该汽车的<code class="docutils literal notranslate"><span class="pre">Country</span></code>在总体数据集中出现次数不超过2则剔除，再按<code class="docutils literal notranslate"><span class="pre">Country</span></code>分组计算价格均值、价格变异系数、该<code class="docutils literal notranslate"><span class="pre">Country</span></code>的汽车数量，其中变异系数的计算方法是标准差除以均值，并在结果中把变异系数重命名为<code class="docutils literal notranslate"><span class="pre">CoV</span></code>。</p></li>
<li><p>按照表中位置的前三分之一、中间三分之一和后三分之一分组，统计<code class="docutils literal notranslate"><span class="pre">Price</span></code>的均值。</p></li>
<li><p>对类型<code class="docutils literal notranslate"><span class="pre">Type</span></code>分组，对<code class="docutils literal notranslate"><span class="pre">Price</span></code>和<code class="docutils literal notranslate"><span class="pre">HP</span></code>分别计算最大值和最小值，结果会产生多级索引，请用下划线把多级列索引合并为单层索引。</p></li>
<li><p>对类型<code class="docutils literal notranslate"><span class="pre">Type</span></code>分组，对<code class="docutils literal notranslate"><span class="pre">HP</span></code>进行组内的<code class="docutils literal notranslate"><span class="pre">min-max</span></code>归一化。</p></li>
<li><p>对类型<code class="docutils literal notranslate"><span class="pre">Type</span></code>分组，计算<code class="docutils literal notranslate"><span class="pre">Disp.</span></code>与<code class="docutils literal notranslate"><span class="pre">HP</span></code>的相关系数。</p></li>
</ol>
</section>
<section id="ex2-transform">
<h3>Ex2：实现transform函数<a class="headerlink" href="#ex2-transform" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">groupby</span></code>对象的构造方法是<code class="docutils literal notranslate"><span class="pre">my_groupby(df,</span> <span class="pre">group_cols)</span></code></p></li>
<li><p>支持单列分组与多列分组</p></li>
<li><p>支持带有标量广播的<code class="docutils literal notranslate"><span class="pre">my_groupby(df)[col].transform(my_func)</span></code>功能</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pandas</span></code>的<code class="docutils literal notranslate"><span class="pre">transform</span></code>不能跨列计算，请支持此功能，即仍返回<code class="docutils literal notranslate"><span class="pre">Series</span></code>但<code class="docutils literal notranslate"><span class="pre">col</span></code>参数为多列</p></li>
<li><p>无需考虑性能与异常处理，只需实现上述功能，在给出测试样例的同时与<code class="docutils literal notranslate"><span class="pre">pandas</span></code>中的<code class="docutils literal notranslate"><span class="pre">transform</span></code>对比结果是否一致</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./python-lib\pandas\notebook"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03%20%E7%B4%A2%E5%BC%95.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">第三章 索引</p>
      </div>
    </a>
    <a class="right-next"
       href="05%20%E5%8F%98%E5%BD%A2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">第五章 变形</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">一、分组模式及其对象</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1. 分组的一般模式</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">2. 分组依据的本质</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#end">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#groupby">3. Groupby对象</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">4. 分组的三大操作</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">二、聚合函数</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">1. 内置聚合函数</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#agg">2. agg方法</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">【END】</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">三、变换和过滤</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform">1. 变换函数与transform方法</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">【END】</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">2. 组索引与过滤</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">【END】</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">四、跨列分组</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apply">1. apply的引入</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">2. apply的使用</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">【END】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">【练一练】</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">【END】</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">五、练习</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ex1">Ex1：汽车数据集</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ex2-transform">Ex2：实现transform函数</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By JH
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>